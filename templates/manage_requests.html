{% extends 'base.html' %}

{% block content %}
<div class="container" style="max-width: 900px; margin: 2rem auto; padding: 2rem;">
    <div style="text-align: center; margin-bottom: 3rem;">
        <h2 style="color: var(--primary-color);">ğŸ‘¨â€ğŸ« Manage Mentorship Requests</h2>
        <p style="color: #666;">Review and process connection requests from students.</p>
    </div>

    <div class="requests-list">
        {% for req in mentor_requests %}
        <div class="request-card"
            style="background: white; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; border: 1px solid #eee;">
            <div style="flex: 1;">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 1rem;">
                    {% if req.student.profile.profile_picture %}
                    <img src="{{ req.student.profile.profile_picture.url }}"
                        style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
                    {% else %}
                    <div
                        style="width: 50px; height: 50px; border-radius: 50%; background: #eee; display: flex; align-items: center; justify-content: center;">
                        ğŸ‘¤</div>
                    {% endif %}
                    <div>
                        <h4 style="margin: 0;">{{ req.student.get_full_name|default:req.student.username }}</h4>
                        <span style="font-size: 0.8rem; color: #777;">Requested {{ req.created_at|timesince }}
                            ago</span>
                    </div>
                    <span style="padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; 
                        {% if req.status == 'pending' %}background: #fff3e0; color: #ef6c00;
                        {% elif req.status == 'accepted' %}background: #e8f5e9; color: #2e7d32;
                        {% else %}background: #ffebee; color: #c62828;{% endif %}">
                        {{ req.get_status_display|upper }}
                    </span>
                </div>
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; font-style: italic; color: #555;">
                    "{{ req.message }}"
                </div>
            </div>

            {% if req.status == 'pending' %}
            <div style="display: flex; flex-direction: column; gap: 10px; margin-left: 2rem;">
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="request_id" value="{{ req.id }}">
                    <button type="submit" name="action" value="accept" class="btn"
                        style="background: #2e7d32; color: white; width: 120px;">Accept âœ…</button>
                    <button type="submit" name="action" value="reject" class="btn"
                        style="background: #c62828; color: white; width: 120px; margin-top: 5px;">Reject âŒ</button>
                </form>
            </div>
            {% elif req.status == 'accepted' %}
            <div style="margin-left: 2rem;">
                <a href="{% url 'mentor_chat' req.id %}" class="btn"
                    style="background: var(--primary-color); color: white;">Open Chat ğŸ’¬</a>
            </div>
            {% endif %}
        </div>
        {% empty %}
        <div
            style="text-align: center; color: #999; padding: 3rem; background: white; border-radius: 12px; border: 2px dashed #eee;">
            <h3>No pending requests</h3>
            <p>Students who request your mentorship will appear here.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}